<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BESS Tycoon: An Incremental Nightmare</title>
    <meta name="description" content="A satirical incremental game about battery energy storage and DevOps chaos">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide React icons (inline)
        const Battery = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect width="16" height="10" x="2" y="7" rx="2" ry="2"/>
                <line x1="22" x2="22" y1="11" y2="13"/>
            </svg>
        );
        
        const Zap = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
        );
        
        const DollarSign = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" x2="12" y1="2" y2="22"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        );
        
        const AlertTriangle = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                <line x1="12" x2="12" y1="9" y2="13"/>
                <line x1="12" x2="12.01" y1="17" y2="17"/>
            </svg>
        );
        
        const TrendingUp = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/>
                <polyline points="16 7 22 7 22 13"/>
            </svg>
        );
        
        const Coffee = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 8h1a4 4 0 1 1 0 8h-1"/>
                <path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/>
                <line x1="6" x2="6" y1="2" y2="4"/>
                <line x1="10" x2="10" y1="2" y2="4"/>
                <line x1="14" x2="14" y1="2" y2="4"/>
            </svg>
        );
        
        const BarChart3 = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 3v18h18"/>
                <path d="M18 17V9"/>
                <path d="M13 17V5"/>
                <path d="M8 17v-3"/>
            </svg>
        );
        
        const Activity = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
        );
        
        const Save = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
            </svg>
        );
        
        const RotateCcw = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
        );
        
        const Download = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
        );
        
        const Upload = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" x2="12" y1="3" y2="15"/>
            </svg>
        );

        // === Plugin System ===

        class PluginRegistry {
          static plugins = new Map();
          static loadedPlugins = [];

          static register(PluginClass) {
            const manifest = PluginClass.manifest;
            if (!manifest || !manifest.id) {
              console.error('Plugin missing required manifest.id');
              return;
            }
            for (const [id, existing] of this.plugins) {
              if (manifest.conflicts?.includes(id) || existing.manifest.conflicts?.includes(manifest.id)) {
                console.warn(`Plugin conflict: ${manifest.id} conflicts with ${id}`);
                return;
              }
            }
            this.plugins.set(manifest.id, PluginClass);
            console.log(`Registered plugin: ${manifest.name} v${manifest.version}`);
          }

          static loadAll(gameEngine, gameState) {
            const loadOrder = this.resolveDependencies();
            for (const pluginId of loadOrder) {
              const PluginClass = this.plugins.get(pluginId);
              if (PluginClass.manifest.unlockCondition && !PluginClass.manifest.unlockCondition(gameState)) {
                console.log(`Plugin ${pluginId} not yet unlocked`);
                continue;
              }
              try {
                PluginClass.init(gameEngine);
                this.loadedPlugins.push(PluginClass);
                console.log(`Loaded plugin: ${PluginClass.manifest.name}`);
              } catch (error) {
                console.error(`Failed to load plugin ${pluginId}:`, error);
              }
            }
          }

          static resolveDependencies() {
            const sorted = [];
            const visited = new Set();
            const visit = (pluginId) => {
              if (visited.has(pluginId)) return;
              visited.add(pluginId);
              const plugin = this.plugins.get(pluginId);
              if (plugin?.manifest.dependencies) {
                for (const depId of plugin.manifest.dependencies) {
                  visit(depId);
                }
              }
              sorted.push(pluginId);
            };
            for (const pluginId of this.plugins.keys()) {
              visit(pluginId);
            }
            return sorted;
          }

          static unload(pluginId) {
            const PluginClass = this.plugins.get(pluginId);
            if (PluginClass && PluginClass.cleanup) {
              PluginClass.cleanup();
            }
            this.loadedPlugins = this.loadedPlugins.filter(p => p.manifest.id !== pluginId);
            console.log(`Unloaded plugin: ${pluginId}`);
          }

          static triggerHook(hookName, ...args) {
            for (const PluginClass of this.loadedPlugins) {
              if (typeof PluginClass[hookName] === 'function') {
                try {
                  PluginClass[hookName](...args);
                } catch (error) {
                  console.error(`Error in ${PluginClass.manifest.id}.${hookName}:`, error);
                }
              }
            }
          }
        }

        class GameEngine {
          constructor() {
            this.resources = new Map();
            this.upgrades = new Map();
            this.events = new Map();
            this.tabs = new Map();
            this.hooks = new Map();
          }

          addResource(resourceDef) {
            this.resources.set(resourceDef.id, resourceDef);
          }

          addUpgrade(upgradeDef) {
            const category = upgradeDef.category || 'core';
            if (!this.upgrades.has(category)) {
              this.upgrades.set(category, []);
            }
            this.upgrades.get(category).push(upgradeDef);
          }

          addEvent(eventDef) {
            this.events.set(eventDef.id, eventDef);
          }

          addTab(tabDef) {
            this.tabs.set(tabDef.id, tabDef);
          }

          on(hookName, callback) {
            if (!this.hooks.has(hookName)) {
              this.hooks.set(hookName, []);
            }
            this.hooks.get(hookName).push(callback);
          }

          emit(hookName, ...args) {
            const callbacks = this.hooks.get(hookName) || [];
            for (const callback of callbacks) {
              callback(...args);
            }
          }

          triggerEvent(eventId) {
            const event = this.events.get(eventId);
            if (event) {
              this.emit('eventTriggered', event);
            }
          }
        }

        const gameEngine = new GameEngine();
        window.PluginRegistry = PluginRegistry;
        window.gameEngine = gameEngine;

        // === Core Resource Definitions ===
        const CORE_RESOURCE_IDS = ['money', 'batteries', 'batteriesPerSecond', 'techDebt', 'coffee'];

        gameEngine.addResource({ id: 'money', name: 'Money', icon: '$', startValue: 10000, displayPrecision: 0, coreKey: 'money' });
        gameEngine.addResource({ id: 'batteries', name: 'Batteries', icon: 'üîã', startValue: 0, displayPrecision: 0, coreKey: 'batteries' });
        gameEngine.addResource({ id: 'batteriesPerSecond', name: 'Production', icon: 'üìà', startValue: 0, displayPrecision: 1, suffix: '/s', coreKey: 'batteriesPerSecond' });
        gameEngine.addResource({ id: 'techDebt', name: 'Tech Debt', icon: '‚ö†Ô∏è', startValue: 0, displayPrecision: 0, coreKey: 'techDebt' });
        gameEngine.addResource({ id: 'coffee', name: 'Coffee Today', icon: '‚òï', startValue: 0, displayPrecision: 0, coreKey: 'coffee' });

        // === Core Tab Definitions ===
        gameEngine.addTab({ id: 'production', name: 'Production', icon: 'üîã', unlockCondition: () => true, core: true });
        gameEngine.addTab({ id: 'monitoring', name: 'Monitoring', icon: 'üìä', unlockCondition: (gs) => gs.grafanaUnlocked, core: true });
        gameEngine.addTab({ id: 'plugins', name: 'Plugins', icon: 'üîå', unlockCondition: () => true, core: true });

        // === Default Game State ===
        const DEFAULT_GAME_STATE = {
          money: 10000,
          batteries: 0,
          batteriesPerSecond: 0,
          techDebt: 0,
          coffee: 0,
          clickPower: 1,
          upgrades: {
            intern: 0,
            autoAssembler: 0,
            skipTesting: false,
            alibabaOrder: false,
            ignoreCerts: false,
            grafanaLicense: false,
          },
          events: [],
          achievements: [],
          grafanaUnlocked: false,
          metrics: {
            temperature: 25,
            voltage: 48.2,
            soc: 87,
            alerts: 0,
          },
          resources: {},
          certifications: {},
          multipliers: { productionSpeed: 1, usSalesPrice: 1 },
          pluginData: {},
        };

        // === Plugin Loading ===
        async function loadPluginFiles() {
          try {
            const resp = await fetch('plugins/manifest.json');
            const data = await resp.json();
            if (data.plugins && data.plugins.length > 0) {
              for (const file of data.plugins) {
                await new Promise((resolve) => {
                  const script = document.createElement('script');
                  script.src = `plugins/${file}`;
                  script.onload = resolve;
                  script.onerror = () => { console.warn(`Plugin ${file} failed to load`); resolve(); };
                  document.head.appendChild(script);
                });
              }
            }
          } catch (e) {
            console.log('No plugins manifest found, skipping plugin loading');
          }
          PluginRegistry.loadAll(gameEngine, DEFAULT_GAME_STATE);
        }

        // === Save Data Migration ===
        function migrateSaveData(raw) {
          if (raw.version === '2.0') return raw;
          // Migrate from v1.0 / no-version flat format
          return {
            version: '2.0',
            money: raw.money ?? 10000,
            batteries: raw.batteries ?? 0,
            batteriesPerSecond: raw.batteriesPerSecond ?? 0,
            techDebt: raw.techDebt ?? 0,
            coffee: raw.coffee ?? 0,
            clickPower: raw.clickPower ?? 1,
            upgrades: raw.upgrades ?? DEFAULT_GAME_STATE.upgrades,
            events: raw.events ?? [],
            achievements: raw.achievements ?? [],
            grafanaUnlocked: raw.grafanaUnlocked ?? false,
            metrics: raw.metrics ?? DEFAULT_GAME_STATE.metrics,
            resources: raw.resources ?? {},
            certifications: raw.certifications ?? {},
            multipliers: raw.multipliers ?? { productionSpeed: 1, usSalesPrice: 1 },
            pluginData: raw.pluginData ?? {},
            timestamp: raw.timestamp,
          };
        }

        const BESSTycoon = () => {
          const [gameState, setGameState] = useState({ ...DEFAULT_GAME_STATE });
          const [activeTab, setActiveTab] = useState('production');
          const [lastSave, setLastSave] = useState(null);
          const [saveStatus, setSaveStatus] = useState('');
          const [showExportImport, setShowExportImport] = useState(false);

          // Load saved game on mount
          useEffect(() => {
            loadGame();
          }, []);

          // Auto-save every 10 seconds
          useEffect(() => {
            const saveInterval = setInterval(() => {
              saveGame(true);
            }, 10000);
            return () => clearInterval(saveInterval);
          }, [gameState]);

          // Save game using localStorage
          const saveGame = (isAuto = false) => {
            try {
              const saveData = {
                ...gameState,
                events: gameState.events.slice(0, 10),
                version: '2.0',
                timestamp: Date.now(),
                pluginsLoaded: PluginRegistry.loadedPlugins.map(p => p.manifest.id),
              };
              PluginRegistry.triggerHook('onBeforeSave', saveData);
              localStorage.setItem('bess-tycoon-save', JSON.stringify(saveData));
              setLastSave(new Date());
              setSaveStatus(isAuto ? 'üíæ Auto-saved' : '‚úÖ Game saved!');
              setTimeout(() => setSaveStatus(''), 2000);
            } catch (error) {
              console.error('Save failed:', error);
              setSaveStatus('‚ùå Save failed');
            }
          };

          // Load game using localStorage
          const loadGame = () => {
            try {
              const saveString = localStorage.getItem('bess-tycoon-save');
              if (saveString) {
                const raw = JSON.parse(saveString);
                const saveData = migrateSaveData(raw);
                const newState = { ...DEFAULT_GAME_STATE };
                for (const key of Object.keys(DEFAULT_GAME_STATE)) {
                  if (saveData[key] !== undefined) {
                    newState[key] = saveData[key];
                  }
                }
                setGameState(prev => ({
                  ...newState,
                  events: [{ text: 'üìÅ Game loaded successfully!', time: Date.now() }, ...(newState.events || []).slice(0, 9)],
                }));
                PluginRegistry.triggerHook('onAfterLoad', saveData, newState);
                setLastSave(new Date(saveData.timestamp));
              }
            } catch (error) {
              console.error('Load failed:', error);
            }
          };

          // Reset game
          const resetGame = () => {
            if (confirm('Are you sure? This will delete ALL progress!')) {
              try {
                localStorage.removeItem('bess-tycoon-save');
                window.location.reload();
              } catch (error) {
                console.error('Reset failed:', error);
              }
            }
          };

          // Export save
          const exportSave = () => {
            const saveData = {
              ...gameState,
              events: gameState.events.slice(0, 10),
              version: '2.0',
              timestamp: Date.now(),
              pluginsLoaded: PluginRegistry.loadedPlugins.map(p => p.manifest.id),
            };
            PluginRegistry.triggerHook('onBeforeSave', saveData);
            const saveString = JSON.stringify(saveData);
            const blob = new Blob([saveString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bess-tycoon-save-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            setSaveStatus('‚úÖ Save exported!');
            setTimeout(() => setSaveStatus(''), 2000);
          };

          // Import save
          const importSave = (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const raw = JSON.parse(e.target.result);
                if (typeof raw.money !== 'number') {
                  throw new Error('Invalid save file');
                }
                const saveData = migrateSaveData(raw);
                const newState = { ...DEFAULT_GAME_STATE };
                for (const key of Object.keys(DEFAULT_GAME_STATE)) {
                  if (saveData[key] !== undefined) {
                    newState[key] = saveData[key];
                  }
                }
                setGameState(prev => ({
                  ...newState,
                  events: [{ text: 'üì• Save file loaded successfully!', time: Date.now() }, ...(newState.events || []).slice(0, 9)],
                }));
                PluginRegistry.triggerHook('onAfterLoad', saveData, newState);
                localStorage.setItem('bess-tycoon-save', JSON.stringify(saveData));
                setSaveStatus('‚úÖ Save imported!');
                setShowExportImport(false);
                setTimeout(() => setSaveStatus(''), 2000);
              } catch (error) {
                console.error('Import failed:', error);
                setSaveStatus('‚ùå Invalid save file!');
                setTimeout(() => setSaveStatus(''), 3000);
              }
            };
            reader.readAsText(file);
            event.target.value = '';
          };

          // Game loop - tick envelope pattern
          useEffect(() => {
            const interval = setInterval(() => {
              setGameState(prev => {
                const state = {
                  ...prev,
                  resources: { ...prev.resources },
                  metrics: { ...prev.metrics },
                  multipliers: { ...prev.multipliers },
                  certifications: { ...prev.certifications },
                  pluginData: { ...prev.pluginData },
                };

                // Recalculate production
                let bps = 0;
                bps += state.upgrades.intern * 0.5;
                bps += state.upgrades.autoAssembler * 2;
                if (state.upgrades.skipTesting) bps *= 1.5;
                state.multipliers = { ...state.multipliers };
                gameEngine.emit('calculateProduction', state);
                bps *= state.multipliers.productionSpeed;
                state.batteriesPerSecond = bps;

                // Core production
                state.batteries += state.batteriesPerSecond;
                state.money += state.batteriesPerSecond * 10;

                // Metrics
                state.metrics = {
                  temperature: Math.max(20, Math.min(60, state.metrics.temperature + (Math.random() - 0.5) * 2)),
                  voltage: Math.max(44, Math.min(52, state.metrics.voltage + (Math.random() - 0.5) * 0.2)),
                  soc: Math.max(0, Math.min(100, state.metrics.soc + (Math.random() - 0.5) * 3)),
                  alerts: Math.random() < 0.05 ? state.metrics.alerts + 1 : state.metrics.alerts,
                };

                // Initialize plugin resources if needed
                for (const [id, def] of gameEngine.resources) {
                  if (state.resources[id] === undefined && !CORE_RESOURCE_IDS.includes(id)) {
                    state.resources[id] = def.startValue || 0;
                  }
                }

                // Plugin tick hooks
                gameEngine.emit('tick', state, 1.0);
                PluginRegistry.triggerHook('onTick', state, 1.0);

                // Random events
                if (Math.random() < 0.01) {
                  const eventText = getRandomEvent(state);
                  state.events = [{ text: eventText, time: Date.now() }, ...state.events.slice(0, 9)];
                }

                return state;
              });
            }, 1000);

            return () => clearInterval(interval);
          }, []);

          const handleClick = () => {
            setGameState(prev => ({
              ...prev,
              batteries: prev.batteries + prev.clickPower,
              money: prev.money + (prev.clickPower * 10),
              coffee: prev.coffee + 0.1,
            }));
          };

          const buyUpgrade = (upgradeId, cost, debtCost = 0) => {
            setGameState(prev => {
              if (prev.money < cost) return prev;
              const state = { ...prev, money: prev.money - cost, techDebt: prev.techDebt + debtCost, upgrades: { ...prev.upgrades } };
              let eventText = '';
              let achievement = null;

              if (upgradeId === 'intern') {
                state.upgrades.intern = state.upgrades.intern + 1;
                eventText = "Hired intern! They work for equity and pizza. üçï";
              } else if (upgradeId === 'autoAssembler') {
                state.upgrades.autoAssembler = state.upgrades.autoAssembler + 1;
                eventText = "Auto-assembler online! Productivity go brrrr üìà";
              } else if (upgradeId === 'skipTesting') {
                state.upgrades.skipTesting = true;
                eventText = "QA is for cowards! +50% speed! üöÄ";
                achievement = { id: "whats-qa", name: "What's QA?", description: "Skip testing phase" };
              } else if (upgradeId === 'alibabaOrder') {
                state.upgrades.alibabaOrder = true;
                state.clickPower = state.clickPower * 2;
                eventText = "Bulk order from Alibaba! Datasheets are... creative. üì¶";
              } else if (upgradeId === 'ignoreCerts') {
                state.upgrades.ignoreCerts = true;
                eventText = "Certifications are just suggestions, right? ü§∑";
                achievement = { id: "yolo", name: "YOLO Engineering", description: "Ignore all safety certifications" };
              } else if (upgradeId === 'grafanaLicense') {
                state.upgrades.grafanaLicense = true;
                state.grafanaUnlocked = true;
                eventText = "üéâ Grafana unlocked! Time to make dashboards nobody understands!";
                achievement = { id: "pretty-graphs", name: "Pretty Graphs", description: "Unlock monitoring suite" };
              }

              if (eventText) {
                state.events = [{ text: eventText, time: Date.now() }, ...state.events.slice(0, 9)];
              }
              if (achievement && !state.achievements.find(a => a.id === achievement.id)) {
                state.achievements = [...state.achievements, achievement];
                state.events = [{ text: `üèÜ Achievement: ${achievement.name}`, time: Date.now() }, ...state.events.slice(0, 9)];
              }

              gameEngine.emit('upgradePurchased', state, upgradeId);
              return state;
            });
          };

          // Buy a plugin-registered upgrade
          const buyPluginUpgrade = (upgradeDef) => {
            setGameState(prev => {
              const costs = upgradeDef.cost || {};
              if (costs.money && prev.money < costs.money) return prev;
              const state = { ...prev, resources: { ...prev.resources }, certifications: { ...prev.certifications }, multipliers: { ...prev.multipliers } };
              if (costs.money) state.money -= costs.money;
              for (const [resId, amount] of Object.entries(costs)) {
                if (resId !== 'money' && state.resources[resId] !== undefined) {
                  if (state.resources[resId] < amount) return prev;
                  state.resources[resId] -= amount;
                }
              }
              if (upgradeDef.effect) {
                upgradeDef.effect(state);
              }
              if (upgradeDef.oneTime) {
                state.pluginData = { ...state.pluginData, [`upgrade_${upgradeDef.id}`]: true };
              }
              return state;
            });
          };

          const getRandomEvent = (state) => {
            const pool = [
              "‚òï Drank too much coffee. Hands shaking. Batteries shaking. Everything shaking.",
              "üìß CEO sent 3 AM Slack: 'Quick question...' (47 paragraphs follow)",
              "üî• Intern configured Modbus by guessing. 12 racks now identify as toasters.",
              "üìä Investor asked for metrics. You showed them a Grafana dashboard with no data.",
              "üêõ Found bug in production. Fix it? Or call it a feature?",
              "üîå Customer called: 'Why is my battery at 140% charge?' Good question.",
              "üíæ Forgot to commit. Lost 3 hours of work. Git is not your friend today.",
            ];
            if (state.upgrades.skipTesting && Math.random() < 0.3) {
              pool.push("‚ö†Ô∏è Skipping testing caused a minor incident. MINOR. Totally minor.");
            }
            if (state.upgrades.ignoreCerts && Math.random() < 0.2) {
              pool.push("üö® Regulator noticed your lack of certifications. They're 'monitoring the situation.'");
            }
            if (state.grafanaUnlocked && Math.random() < 0.25) {
              const grafanaEvents = [
                "üìâ Grafana query took 45 seconds. Coffee break!",
                "üî¥ Alert: Temperature spike! (It was just someone's laptop near the sensor)",
                "üìä Created 47 new dashboard panels. Still can't find the useful one.",
                "‚ö†Ô∏è InfluxDB retention policy expired. 6 months of data? Gone!",
              ];
              pool.push(grafanaEvents[Math.floor(Math.random() * grafanaEvents.length)]);
            }
            return pool[Math.floor(Math.random() * pool.length)];
          };

          const addEvent = (text) => {
            setGameState(prev => ({
              ...prev,
              events: [{ text, time: Date.now() }, ...prev.events.slice(0, 9)],
            }));
          };

          const upgradesData = [
            {
              id: 'intern',
              name: 'Hire Intern',
              cost: 5000 * (gameState.upgrades.intern + 1),
              owned: gameState.upgrades.intern,
              effect: '+0.5 batteries/sec',
              debt: 2,
              tooltip: 'They work for equity. Equity is free, right?'
            },
            {
              id: 'autoAssembler',
              name: 'Auto-Assembler',
              cost: 20000 * (gameState.upgrades.autoAssembler + 1),
              owned: gameState.upgrades.autoAssembler,
              effect: '+2 batteries/sec',
              debt: 5,
              tooltip: 'Because manual labor is so 2010'
            },
            {
              id: 'skipTesting',
              name: 'Skip Testing Phase',
              cost: 50000,
              owned: gameState.upgrades.skipTesting ? 1 : 0,
              effect: '+50% production speed',
              debt: 25,
              tooltip: "What's the worst that could happen?",
              oneTime: true
            },
            {
              id: 'alibabaOrder',
              name: 'Alibaba Bulk Order',
              cost: 100000,
              owned: gameState.upgrades.alibabaOrder ? 1 : 0,
              effect: 'Double click power',
              debt: 15,
              tooltip: 'Cheap cells! Mysterious datasheets! Adventure!',
              oneTime: true
            },
            {
              id: 'ignoreCerts',
              name: 'Ignore Certifications',
              cost: 150000,
              owned: gameState.upgrades.ignoreCerts ? 1 : 0,
              effect: 'Save $100k annually',
              debt: 50,
              tooltip: 'Regulations are just suggestions',
              oneTime: true
            },
            {
              id: 'grafanaLicense',
              name: 'Deploy Grafana',
              cost: 75000,
              owned: gameState.upgrades.grafanaLicense ? 1 : 0,
              effect: 'Unlock monitoring tab',
              debt: 30,
              tooltip: 'Look professional in investor demos! (Data optional)',
              oneTime: true
            },
          ];

          // Collect plugin upgrades for display
          const pluginUpgradesData = [];
          for (const [category, upgrades] of gameEngine.upgrades) {
            for (const upg of upgrades) {
              const isOwned = gameState.pluginData[`upgrade_${upg.id}`] === true;
              if (upg.unlockCondition && !upg.unlockCondition(gameState)) continue;
              pluginUpgradesData.push({
                id: upg.id,
                name: upg.name,
                cost: upg.cost?.money || 0,
                owned: isOwned ? 1 : 0,
                effect: upg.description || '',
                debt: 0,
                tooltip: upg.description || '',
                oneTime: upg.oneTime || false,
                isPlugin: true,
                upgradeDef: upg,
              });
            }
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4">
              <div className="max-w-6xl mx-auto">
                <div className="text-center mb-6">
                  <h1 className="text-4xl font-bold mb-2 text-cyan-400">
                    ‚ö° BESS Tycoon: An Incremental Nightmare
                  </h1>
                  <p className="text-gray-400 italic">"Move fast and break grids"</p>
                  {saveStatus && (
                    <p className="text-sm text-green-400 mt-2">{saveStatus}</p>
                  )}
                </div>

                <div className="grid grid-cols-2 md:grid-cols-5 gap-3 mb-6">
                  <div className="bg-slate-800 p-3 rounded-lg border border-cyan-500/30">
                    <div className="flex items-center gap-2 text-green-400">
                      <DollarSign size={20} />
                      <span className="font-mono">${Math.floor(gameState.money).toLocaleString()}</span>
                    </div>
                    <div className="text-xs text-gray-400">Money</div>
                  </div>

                  <div className="bg-slate-800 p-3 rounded-lg border border-cyan-500/30">
                    <div className="flex items-center gap-2 text-cyan-400">
                      <Battery size={20} />
                      <span className="font-mono">{Math.floor(gameState.batteries).toLocaleString()}</span>
                    </div>
                    <div className="text-xs text-gray-400">Batteries</div>
                  </div>

                  <div className="bg-slate-800 p-3 rounded-lg border border-cyan-500/30">
                    <div className="flex items-center gap-2 text-blue-400">
                      <TrendingUp size={20} />
                      <span className="font-mono">{gameState.batteriesPerSecond.toFixed(1)}/s</span>
                    </div>
                    <div className="text-xs text-gray-400">Production</div>
                  </div>

                  <div className="bg-slate-800 p-3 rounded-lg border border-red-500/30">
                    <div className="flex items-center gap-2 text-red-400">
                      <AlertTriangle size={20} />
                      <span className="font-mono">{gameState.techDebt}</span>
                    </div>
                    <div className="text-xs text-gray-400">Tech Debt</div>
                  </div>

                  <div className="bg-slate-800 p-3 rounded-lg border border-amber-500/30">
                    <div className="flex items-center gap-2 text-amber-400">
                      <Coffee size={20} />
                      <span className="font-mono">{Math.floor(gameState.coffee)}</span>
                    </div>
                    <div className="text-xs text-gray-400">Coffee Today</div>
                  </div>

                  {/* Plugin resources */}
                  {Array.from(gameEngine.resources.values())
                    .filter(r => !CORE_RESOURCE_IDS.includes(r.id))
                    .map(r => (
                      <div key={r.id} className="bg-slate-800 p-3 rounded-lg border border-purple-500/30">
                        <div className="flex items-center gap-2 text-purple-400">
                          <span>{r.icon || '?'}</span>
                          <span className="font-mono">
                            {(gameState.resources[r.id] ?? r.startValue ?? 0).toFixed(r.displayPrecision ?? 0)}
                            {r.suffix || ''}
                          </span>
                        </div>
                        <div className="text-xs text-gray-400">{r.name}</div>
                      </div>
                    ))
                  }
                </div>

                <div className="flex gap-2 mb-6 flex-wrap">
                  {Array.from(gameEngine.tabs.values()).map(tab => {
                    const unlocked = tab.unlockCondition ? tab.unlockCondition(gameState) : true;
                    return (
                      <button
                        key={tab.id}
                        onClick={() => unlocked && setActiveTab(tab.id)}
                        className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                          activeTab === tab.id
                            ? 'bg-cyan-500 text-white'
                            : 'bg-slate-800 text-gray-400 hover:bg-slate-700'
                        } ${!unlocked ? 'opacity-50 cursor-not-allowed' : ''}`}
                        disabled={!unlocked}
                      >
                        {tab.icon} {tab.name} {!unlocked && 'üîí'}
                      </button>
                    );
                  })}
                  <button
                    onClick={() => saveGame(false)}
                    className="ml-auto px-4 py-2 rounded-lg bg-green-600 hover:bg-green-500 font-semibold transition-all flex items-center gap-2"
                  >
                    <Save size={16} /> Save
                  </button>
                  <button
                    onClick={() => setShowExportImport(!showExportImport)}
                    className="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 font-semibold transition-all flex items-center gap-2"
                  >
                    <Download size={16} /> Backup
                  </button>
                  <button
                    onClick={resetGame}
                    className="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-500 font-semibold transition-all flex items-center gap-2"
                  >
                    <RotateCcw size={16} /> Reset
                  </button>
                </div>

                {showExportImport && (
                  <div className="mb-6 bg-slate-800 p-4 rounded-lg border border-blue-500/30">
                    <h3 className="text-lg font-bold mb-3 text-blue-400">üíæ Backup & Restore</h3>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div className="bg-slate-900 p-4 rounded">
                        <h4 className="font-semibold text-white mb-2 flex items-center gap-2">
                          <Download size={16} className="text-green-400" />
                          Export Save
                        </h4>
                        <p className="text-sm text-gray-400 mb-3">
                          Download your save file as JSON. Keep it safe! Your tech debt is precious.
                        </p>
                        <button
                          onClick={exportSave}
                          className="w-full px-4 py-2 bg-green-600 hover:bg-green-500 rounded font-semibold transition-all"
                        >
                          Download Save File
                        </button>
                      </div>
                      
                      <div className="bg-slate-900 p-4 rounded">
                        <h4 className="font-semibold text-white mb-2 flex items-center gap-2">
                          <Upload size={16} className="text-blue-400" />
                          Import Save
                        </h4>
                        <p className="text-sm text-gray-400 mb-3">
                          Load a save file. Warning: This will overwrite your current game!
                        </p>
                        <label className="block">
                          <input
                            type="file"
                            accept=".json"
                            onChange={importSave}
                            className="hidden"
                            id="import-file"
                          />
                          <label
                            htmlFor="import-file"
                            className="block w-full px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded font-semibold transition-all text-center cursor-pointer"
                          >
                            Choose Save File
                          </label>
                        </label>
                      </div>
                    </div>
                    <div className="mt-3 p-3 bg-yellow-900/20 rounded border border-yellow-500/30">
                      <p className="text-xs text-gray-400">
                        üí° <span className="text-yellow-400">Pro tip:</span> Export your save before making risky decisions. 
                        Like deploying on Friday at 4:45 PM. Or ignoring all certifications.
                      </p>
                    </div>
                  </div>
                )}

                {activeTab === 'production' && (
                  <div className="grid md:grid-cols-2 gap-6">
                    <div className="space-y-6">
                      <div className="bg-slate-800 p-6 rounded-lg border border-cyan-500/30">
                        <h2 className="text-xl font-bold mb-4 text-cyan-400">Production</h2>
                        
                        <div className="flex flex-col items-center gap-4">
                          <button
                            onClick={handleClick}
                            className="w-32 h-32 bg-gradient-to-br from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 rounded-lg flex items-center justify-center transition-all transform hover:scale-105 active:scale-95 shadow-lg"
                            title="YOLO"
                          >
                            <Battery size={64} className="text-white" />
                          </button>
                          
                          <div className="text-center">
                            <p className="text-gray-400 text-sm">Click to assemble batteries!</p>
                            <p className="text-cyan-400 font-mono">+{gameState.clickPower} per click</p>
                          </div>
                        </div>
                      </div>

                      <div className="bg-slate-800 p-4 rounded-lg border border-cyan-500/30">
                        <h3 className="text-lg font-bold mb-3 text-cyan-400">Event Log</h3>
                        <div className="space-y-2 max-h-48 overflow-y-auto">
                          {gameState.events.length === 0 && (
                            <p className="text-gray-500 text-sm italic">Nothing has gone wrong... yet.</p>
                          )}
                          {gameState.events.map((event, i) => (
                            <div key={event.time + '-' + i} className="text-sm text-gray-300 bg-slate-900 p-2 rounded animate-fade-in">
                              {event.text}
                            </div>
                          ))}
                        </div>
                      </div>

                      {gameState.achievements.length > 0 && (
                        <div className="bg-slate-800 p-4 rounded-lg border border-yellow-500/30">
                          <h3 className="text-lg font-bold mb-3 text-yellow-400">üèÜ Achievements</h3>
                          <div className="space-y-2">
                            {gameState.achievements.map(ach => (
                              <div key={ach.id} className="text-sm bg-slate-900 p-2 rounded">
                                <div className="font-bold text-yellow-400">{ach.name}</div>
                                <div className="text-gray-400 text-xs">{ach.description}</div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>

                    <div className="bg-slate-800 p-6 rounded-lg border border-cyan-500/30">
                      <h2 className="text-xl font-bold mb-4 text-cyan-400">Upgrades</h2>
                      
                      <div className="space-y-3">
                        {[...upgradesData, ...pluginUpgradesData].map(upgrade => {
                          const canBuy = gameState.money >= upgrade.cost && (!upgrade.oneTime || upgrade.owned === 0);
                          const isOwned = upgrade.oneTime && upgrade.owned > 0;

                          return (
                            <div
                              key={upgrade.id}
                              className={`p-4 rounded-lg border ${
                                isOwned
                                  ? 'bg-slate-900/50 border-green-500/30'
                                  : canBuy
                                    ? 'bg-slate-900 border-cyan-500/50 hover:border-cyan-500 cursor-pointer'
                                    : 'bg-slate-900/30 border-slate-700 opacity-50'
                              } transition-all`}
                              onClick={() => canBuy && (upgrade.isPlugin ? buyPluginUpgrade(upgrade.upgradeDef) : buyUpgrade(upgrade.id, upgrade.cost, upgrade.debt))}
                              title={upgrade.tooltip}
                            >
                              <div className="flex justify-between items-start mb-2">
                                <div>
                                  <div className="font-bold text-white">
                                    {upgrade.name}
                                    {upgrade.owned > 0 && !upgrade.oneTime && (
                                      <span className="ml-2 text-cyan-400">x{upgrade.owned}</span>
                                    )}
                                    {isOwned && <span className="ml-2 text-green-400">‚úì</span>}
                                    {upgrade.isPlugin && <span className="ml-2 text-purple-400 text-xs">[plugin]</span>}
                                  </div>
                                  <div className="text-xs text-gray-400">{upgrade.effect}</div>
                                </div>
                                <div className="text-right">
                                  <div className="text-green-400 font-mono text-sm">
                                    ${upgrade.cost.toLocaleString()}
                                  </div>
                                  {upgrade.debt > 0 && <div className="text-red-400 text-xs">+{upgrade.debt} debt</div>}
                                </div>
                              </div>
                              <div className="text-xs text-gray-500 italic">{upgrade.tooltip}</div>
                            </div>
                          );
                        })}
                      </div>
                      
                      <div className="mt-4 p-3 bg-slate-900 rounded border border-red-500/30">
                        <p className="text-xs text-gray-400">
                          üí° <span className="text-red-400">Tech Debt</span> accumulates with shortcuts. 
                          At 100, bad things happen. Very bad things.
                        </p>
                      </div>
                    </div>
                  </div>
                )}

                {activeTab === 'monitoring' && gameState.grafanaUnlocked && (
                  <div className="space-y-6">
                    <div className="bg-slate-800 p-6 rounded-lg border border-cyan-500/30">
                      <div className="flex items-center gap-3 mb-4">
                        <BarChart3 className="text-orange-500" size={32} />
                        <div>
                          <h2 className="text-2xl font-bold text-orange-500">Grafana OSS 9.5.2</h2>
                          <p className="text-gray-400 text-sm">Battery Management Dashboard v47</p>
                        </div>
                      </div>

                      <div className="grid md:grid-cols-2 gap-4">
                        <div className="bg-slate-900 p-4 rounded border border-orange-500/30">
                          <div className="flex items-center justify-between mb-3">
                            <h3 className="text-sm font-semibold text-gray-300">Cell Temperature (Avg)</h3>
                            <Activity size={16} className="text-orange-400" />
                          </div>
                          <div className="text-4xl font-bold text-orange-400 mb-2">
                            {gameState.metrics.temperature.toFixed(1)}¬∞C
                          </div>
                          <div className="h-20 bg-slate-950 rounded flex items-end justify-around p-2">
                            {[...Array(20)].map((_, i) => (
                              <div
                                key={i}
                                className="w-1 bg-gradient-to-t from-orange-600 to-orange-400 rounded-t"
                                style={{
                                  height: `${Math.random() * 100}%`,
                                }}
                              />
                            ))}
                          </div>
                          <p className="text-xs text-gray-500 mt-2">Last updated: now</p>
                        </div>

                        <div className="bg-slate-900 p-4 rounded border border-cyan-500/30">
                          <div className="flex items-center justify-between mb-3">
                            <h3 className="text-sm font-semibold text-gray-300">System Voltage</h3>
                            <Zap size={16} className="text-cyan-400" />
                          </div>
                          <div className="text-4xl font-bold text-cyan-400 mb-2">
                            {gameState.metrics.voltage.toFixed(2)}V
                          </div>
                          <div className="h-20 bg-slate-950 rounded flex items-end justify-around p-2">
                            {[...Array(20)].map((_, i) => (
                              <div
                                key={i}
                                className="w-1 bg-gradient-to-t from-cyan-600 to-cyan-400 rounded-t"
                                style={{
                                  height: `${80 + Math.random() * 20}%`,
                                }}
                              />
                            ))}
                          </div>
                          <p className="text-xs text-gray-500 mt-2">Query time: 0.043s</p>
                        </div>

                        <div className="bg-slate-900 p-4 rounded border border-green-500/30">
                          <div className="flex items-center justify-between mb-3">
                            <h3 className="text-sm font-semibold text-gray-300">State of Charge (SoC)</h3>
                            <Battery size={16} className="text-green-400" />
                          </div>
                          <div className="text-4xl font-bold text-green-400 mb-2">
                            {gameState.metrics.soc.toFixed(0)}%
                          </div>
                          <div className="h-20 bg-slate-950 rounded overflow-hidden">
                            <div
                              className="h-full bg-gradient-to-r from-green-600 to-green-400 transition-all duration-1000"
                              style={{ width: `${gameState.metrics.soc}%` }}
                            />
                          </div>
                          <p className="text-xs text-gray-500 mt-2">Target: 85% ¬± 5%</p>
                        </div>

                        <div className="bg-slate-900 p-4 rounded border border-red-500/30">
                          <div className="flex items-center justify-between mb-3">
                            <h3 className="text-sm font-semibold text-gray-300">Active Alerts</h3>
                            <AlertTriangle size={16} className="text-red-400" />
                          </div>
                          <div className="text-4xl font-bold text-red-400 mb-2">
                            {gameState.metrics.alerts}
                          </div>
                          <div className="text-xs text-gray-400 space-y-1">
                            <div className="bg-slate-950 p-2 rounded">
                              <span className="text-yellow-400">‚ö†</span> Cell voltage drift +0.003V
                            </div>
                            <div className="bg-slate-950 p-2 rounded">
                              <span className="text-yellow-400">‚ö†</span> Humidity sensor offline
                            </div>
                            <div className="bg-slate-950 p-2 rounded">
                              <span className="text-red-400">üî¥</span> Someone left debug logging on
                            </div>
                          </div>
                        </div>

                        <div className="bg-slate-900 p-4 rounded border border-purple-500/30 md:col-span-2">
                          <div className="flex items-center justify-between mb-3">
                            <h3 className="text-sm font-semibold text-gray-300">Round-Trip Efficiency (Nobody Knows What This Means)</h3>
                          </div>
                          <div className="h-32 bg-slate-950 rounded flex items-center justify-center">
                            <div className="text-center text-gray-500">
                              <div className="text-6xl mb-2">üìä</div>
                              <p className="text-sm">No Data</p>
                              <p className="text-xs">(Someone forgot to configure InfluxDB)</p>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div className="mt-4 p-3 bg-red-900/20 rounded border border-red-500/30">
                        <p className="text-xs text-gray-400">
                          ‚ö†Ô∏è <span className="text-red-400">Alert fatigue detected:</span> You've acknowledged 847 alerts this week. 
                          Maybe set better thresholds? Or just... ignore them like everyone else? ü§∑
                        </p>
                      </div>
                    </div>
                  </div>
                )}

                {/* Plugin Manager tab */}
                {activeTab === 'plugins' && (
                  <div className="space-y-6">
                    <div className="bg-slate-800 p-6 rounded-lg border border-purple-500/30">
                      <h2 className="text-2xl font-bold mb-4 text-purple-400">üîå Plugin Manager</h2>
                      <p className="text-gray-400 mb-4">Extend your game with plugins. Each plugin adds new mechanics, resources, and content.</p>

                      {PluginRegistry.plugins.size === 0 ? (
                        <div className="bg-slate-900 p-6 rounded text-center">
                          <div className="text-4xl mb-2">üì¶</div>
                          <p className="text-gray-400">No plugins installed yet.</p>
                          <p className="text-gray-500 text-sm mt-1">Add plugin files to the plugins/ directory and list them in plugins/manifest.json</p>
                        </div>
                      ) : (
                        <div className="space-y-3">
                          {Array.from(PluginRegistry.plugins.values()).map(plugin => {
                            const manifest = plugin.manifest;
                            const isLoaded = PluginRegistry.loadedPlugins.includes(plugin);
                            const canUnlock = manifest.unlockCondition ? manifest.unlockCondition(gameState) : true;
                            return (
                              <div key={manifest.id} className={`p-4 rounded-lg border ${isLoaded ? 'bg-slate-900 border-green-500/30' : 'bg-slate-900/50 border-slate-700'}`}>
                                <div className="flex justify-between items-start">
                                  <div>
                                    <div className="font-bold text-white">{manifest.name} <span className="text-gray-500 text-sm font-normal">v{manifest.version}</span></div>
                                    <div className="text-sm text-gray-400">{manifest.description}</div>
                                    {manifest.author && <div className="text-xs text-gray-500 mt-1">By: {manifest.author}</div>}
                                  </div>
                                  <div className={`px-2 py-1 rounded text-xs font-semibold ${isLoaded ? 'bg-green-900 text-green-400' : canUnlock ? 'bg-yellow-900 text-yellow-400' : 'bg-slate-700 text-gray-400'}`}>
                                    {isLoaded ? 'Loaded' : canUnlock ? 'Available' : 'Locked'}
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      )}

                      <div className="mt-6 p-4 bg-slate-900 rounded border border-purple-500/30">
                        <h3 className="font-semibold text-purple-400 mb-2">System Info</h3>
                        <div className="text-xs text-gray-400 space-y-1">
                          <p>Registered plugins: {PluginRegistry.plugins.size}</p>
                          <p>Loaded plugins: {PluginRegistry.loadedPlugins.length}</p>
                          <p>Registered resources: {gameEngine.resources.size}</p>
                          <p>Registered tabs: {gameEngine.tabs.size}</p>
                          <p>Registered hooks: {gameEngine.hooks.size}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Dynamic plugin tabs */}
                {!['production', 'monitoring', 'plugins'].includes(activeTab) && (() => {
                  const tab = gameEngine.tabs.get(activeTab);
                  if (tab && tab.render) {
                    return <div dangerouslySetInnerHTML={{ __html: tab.render(gameState) }} />;
                  }
                  return null;
                })()}

                <div className="mt-6 text-center text-gray-500 text-sm space-y-1">
                  <p>A satirical tribute to Universal Paperclips & the chaos of DevOps üíö</p>
                  {lastSave && (
                    <p className="text-xs">Last saved: {lastSave.toLocaleTimeString()}</p>
                  )}
                </div>
              </div>

              <style>{`
                @keyframes fade-in {
                  from { opacity: 0; transform: translateY(-10px); }
                  to { opacity: 1; transform: translateY(0); }
                }
                .animate-fade-in {
                  animation: fade-in 0.3s ease-out;
                }
              `}</style>
            </div>
          );
        };

        // Boot: load plugins, then render
        (async function boot() {
          await loadPluginFiles();
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(<BESSTycoon />);
        })();
    </script>
</body>
</html>